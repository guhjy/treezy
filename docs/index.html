<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Makes it Easier To Work With Decision Trees &bull; treezy</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">treezy</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">
<div id="treezy" class="section level1">
<div class="page-header"><h1 class="hasAnchor"><a href="#treezy" class="anchor"> </a>treezy</h1></div>

<p>Makes handling output from decision trees easy. Treezy.</p>
<p>Decision trees are a commonly used tool in statistics and data science, but sometimes getting the information out of them can be a bit difficult. This package makes it easy to work with decision trees, hence, <code>treezy</code>. These functions are more formal reworkings from the helper functions I had written in <a href="www.github.com/njtierney/neato">neato</a>. The treezy package is inspired by David Robinson&rsquo;s excellent <a href="https://github.com/tidyverse/broom"><code>broom</code></a> package. Perhaps one day these functions will make their way into broom, but for the moment this package will focus on decision trees, which tend to give different output to many of the (many!) <a href="https://github.com/tidyverse/broom#available-tidiers">packages/analyses that broom deals with</a>.</p>
<p><strong>treezy is very much in a beta stage, please use it with that in mind</strong></p>
<!-- README.md is generated from README.Rmd. Please edit that file -->
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor"><a href="#installation" class="anchor"> </a>Installation</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># install.packages("devtools")</span>
devtools::<span class="kw">install_github</span>(<span class="st">"njtierney/treezy"</span>)</code></pre></div>
</div>
<div id="example-usage" class="section level1">
<h1 class="hasAnchor"><a href="#example-usage" class="anchor"> </a>Example usage</h1>
<div id="explore-variable-importance-with-importance_table-and-importance_plot" class="section level2">
<h2 class="hasAnchor"><a href="#explore-variable-importance-with-importance_table-and-importance_plot" class="anchor"> </a>Explore variable importance with <code>importance_table</code> and <code>importance_plot</code></h2>
<div id="rpart" class="section level3">
<h3 class="hasAnchor"><a href="#rpart" class="anchor"> </a>rpart</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(treezy)
<span class="kw">library</span>(rpart)

fit_rpart_kyp &lt;-<span class="st"> </span><span class="kw">rpart</span>(Kyphosis ~<span class="st"> </span>., <span class="dt">data =</span> kyphosis)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># default method for looking at importance</span>

<span class="co"># variable importance</span>
fit_rpart_kyp$variable.importance
<span class="co">#&gt;    Start      Age   Number </span>
<span class="co">#&gt; 8.198442 3.101801 1.521863</span>

<span class="co"># with treezy</span>

<span class="kw"><a href="reference/importance_table.html">importance_table</a></span>(fit_rpart_kyp)
<span class="co">#&gt; # A tibble: 3 &times; 2</span>
<span class="co">#&gt;   variable importance</span>
<span class="co">#&gt;     &lt;fctr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1    Start   8.198442</span>
<span class="co">#&gt; 2      Age   3.101801</span>
<span class="co">#&gt; 3   Number   1.521863</span>

<span class="kw"><a href="reference/importance_plot.html">importance_plot</a></span>(fit_rpart_kyp)</code></pre></div>
<p><img src="README-unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># extend and modify</span>
<span class="kw">library</span>(ggplot2)
<span class="kw"><a href="reference/importance_plot.html">importance_plot</a></span>(fit_rpart_kyp) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme_bw</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"My Importance Scores"</span>,
         <span class="dt">subtitle =</span> <span class="st">"For a CART Model"</span>)</code></pre></div>
<p><img src="README-unnamed-chunk-4-2.png" width="672"></p>
</div>
<div id="randomforest" class="section level3">
<h3 class="hasAnchor"><a href="#randomforest" class="anchor"> </a>randomForest</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(randomForest)
<span class="kw">set.seed</span>(<span class="dv">131</span>)
fit_rf_ozone &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Ozone ~<span class="st"> </span>., 
                             <span class="dt">data =</span> airquality, 
                             <span class="dt">mtry=</span><span class="dv">3</span>,
                             <span class="dt">importance=</span><span class="ot">TRUE</span>, 
                             <span class="dt">na.action=</span>na.omit)
  
fit_rf_ozone
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt;  randomForest(formula = Ozone ~ ., data = airquality, mtry = 3,      importance = TRUE, na.action = na.omit) </span>
<span class="co">#&gt;                Type of random forest: regression</span>
<span class="co">#&gt;                      Number of trees: 500</span>
<span class="co">#&gt; No. of variables tried at each split: 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;           Mean of squared residuals: 303.8304</span>
<span class="co">#&gt;                     % Var explained: 72.31</span>

## Show "importance" of variables: higher value mean more important:

<span class="co"># randomForest has a better importance method than rpart</span>
<span class="kw">importance</span>(fit_rf_ozone)
<span class="co">#&gt;           %IncMSE IncNodePurity</span>
<span class="co">#&gt; Solar.R 11.092244     10534.237</span>
<span class="co">#&gt; Wind    23.503562     43833.128</span>
<span class="co">#&gt; Temp    42.027171     55218.049</span>
<span class="co">#&gt; Month    4.070413      2032.652</span>
<span class="co">#&gt; Day      2.632496      7173.194</span>

## use importance_table
<span class="kw"><a href="reference/importance_table.html">importance_table</a></span>(fit_rf_ozone)
<span class="co">#&gt; # A tibble: 5 &times; 3</span>
<span class="co">#&gt;   variable `%IncMSE` IncNodePurity</span>
<span class="co">#&gt;     &lt;fctr&gt;     &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1  Solar.R 11.092244     10534.237</span>
<span class="co">#&gt; 2     Wind 23.503562     43833.128</span>
<span class="co">#&gt; 3     Temp 42.027171     55218.049</span>
<span class="co">#&gt; 4    Month  4.070413      2032.652</span>
<span class="co">#&gt; 5      Day  2.632496      7173.194</span>

<span class="co"># now plot it</span>
<span class="kw"><a href="reference/importance_plot.html">importance_plot</a></span>(fit_rf_ozone)</code></pre></div>
<p><img src="README-unnamed-chunk-5-1.png" width="672"></p>
</div>
</div>
<div id="calculate-residual-sums-of-squares-for-rpart-and-randomforest" class="section level2">
<h2 class="hasAnchor"><a href="#calculate-residual-sums-of-squares-for-rpart-and-randomforest" class="anchor"> </a>Calculate residual sums of squares for rpart and randomForest</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># CART</span>
<span class="kw"><a href="reference/rss.html">rss</a></span>(fit_rpart_kyp)
<span class="co">#&gt; [1] 13</span>

<span class="co"># randomForest</span>
<span class="kw"><a href="reference/rss.html">rss</a></span>(fit_rf_ozone)
<span class="co">#&gt; [1] 33725.18</span></code></pre></div>
</div>
<div id="plot-partial-effects" class="section level2">
<h2 class="hasAnchor"><a href="#plot-partial-effects" class="anchor"> </a>plot partial effects</h2>
</div>
<div id="using-gbm-step-from-dismo-package" class="section level2">
<h2 class="hasAnchor"><a href="#using-gbm-step-from-dismo-package" class="anchor"> </a>Using gbm.step from dismo package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># using gbm.step from the dismo package</span>
<span class="kw">library</span>(gbm)
<span class="kw">library</span>(dismo)
<span class="co"># load data</span>
<span class="kw">data</span>(Anguilla_train)

anguilla_train &lt;-<span class="st"> </span>Anguilla_train[<span class="dv">1</span>:<span class="dv">200</span>,]

<span class="co"># fit model</span>
angaus_tc_5_lr_01 &lt;-<span class="st"> </span><span class="kw">gbm.step</span>(<span class="dt">data =</span> anguilla_train,
                              <span class="dt">gbm.x =</span> <span class="dv">3</span>:<span class="dv">14</span>,
                              <span class="dt">gbm.y =</span> <span class="dv">2</span>,
                              <span class="dt">family =</span> <span class="st">"bernoulli"</span>,
                              <span class="dt">tree.complexity =</span> <span class="dv">5</span>,
                              <span class="dt">learning.rate =</span> <span class="fl">0.01</span>,
                              <span class="dt">bag.fraction =</span> <span class="fl">0.5</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt;  GBM STEP - version 2.9 </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Performing cross-validation optimisation of a boosted regression tree model </span>
<span class="co">#&gt; for Angaus and using a family of bernoulli </span>
<span class="co">#&gt; Using 200 observations and 12 predictors </span>
<span class="co">#&gt; creating 10 initial models of 50 trees </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  folds are stratified by prevalence </span>
<span class="co">#&gt; total mean deviance =  1.0905 </span>
<span class="co">#&gt; tolerance is fixed at  0.0011 </span>
<span class="co">#&gt; ntrees resid. dev. </span>
<span class="co">#&gt; 50    0.9103 </span>
<span class="co">#&gt; now adding trees... </span>
<span class="co">#&gt; 100   0.8352 </span>
<span class="co">#&gt; 150   0.7996 </span>
<span class="co">#&gt; 200   0.7808 </span>
<span class="co">#&gt; 250   0.7708 </span>
<span class="co">#&gt; 300   0.7664 </span>
<span class="co">#&gt; 350   0.7664 </span>
<span class="co">#&gt; 400   0.772 </span>
<span class="co">#&gt; 450   0.7851 </span>
<span class="co">#&gt; 500   0.7912 </span>
<span class="co">#&gt; 550   0.7964 </span>
<span class="co">#&gt; 600   0.8025 </span>
<span class="co">#&gt; 650   0.8107 </span>
<span class="co">#&gt; 700   0.8205 </span>
<span class="co">#&gt; 750   0.8267 </span>
<span class="co">#&gt; 800   0.8351 </span>
<span class="co">#&gt; 850   0.8497 </span>
<span class="co">#&gt; 900   0.8606 </span>
<span class="co">#&gt; 950   0.8756 </span>
<span class="co">#&gt; 1000   0.8903</span></code></pre></div>
<p><img src="README-unnamed-chunk-7-1.png" width="672"></p>
<pre><code>#&gt; 
#&gt; mean total deviance = 1.09 
#&gt; mean residual deviance = 0.408 
#&gt;  
#&gt; estimated cv deviance = 0.766 ; se = 0.053 
#&gt;  
#&gt; training data correlation = 0.86 
#&gt; cv correlation =  0.559 ; se = 0.053 
#&gt;  
#&gt; training data AUC score = 0.986 
#&gt; cv AUC score = 0.867 ; se = 0.022 
#&gt;  
#&gt; elapsed time -  0.08 minutes</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="reference/gg_partial_plot.html">gg_partial_plot</a></span>(angaus_tc_5_lr_01,
                <span class="dt">var =</span> <span class="kw">c</span>(<span class="st">"SegSumT"</span>,
                        <span class="st">"SegTSeas"</span>))</code></pre></div>
<p><img src="README-unnamed-chunk-8-1.png" width="672"></p>
</div>
</div>
<div id="known-issues" class="section level1">
<h1 class="hasAnchor"><a href="#known-issues" class="anchor"> </a>Known issues</h1>
<p>treezy is in a beta stage at the moment, so please use with caution. Here are a few things to keep in mind:</p>
<ul><li>The functions <strong>have not been made compatible with Gradient Boosted Machines</strong>, but this is on the cards. This was initially written for some old code which used gbm.step</li>
<li>The partial dependence plots have not been tested, and were initially intended for use with gbm.step, as in the <a href="https://cran.r-project.org/web/packages/dismo/vignettes/brt.pdf">elith et al. paper</a></li>
</ul></div>
<div id="future-work" class="section level1">
<h1 class="hasAnchor"><a href="#future-work" class="anchor"> </a>Future work</h1>
<ul><li>Extend to other kinds of decision trees (<code>gbm</code>, <code>tree</code> and more)</li>
<li>provide tools for extracting out other decision tree information (decision tree rules, surrogate splits, burling).</li>
<li>provide a method to extract out decision trees from randomForest and BRT so that they can be visualised with rpart.plot,</li>
<li>provide tidy summary information of the decision trees, potentially in the format of <code>broom</code>&rsquo;s <code>augment</code>, <code>tidy</code>, and <code>glance</code> functions. For example, <code>rpart_fit$splits</code></li>
<li>think about a way to store the data structure of a decision tree as a nested dataframe</li>
<li>functions to allow for plotting of a prediction grid over two variables</li>
</ul></div>
<div id="acknowledgements" class="section level1">
<h1 class="hasAnchor"><a href="#acknowledgements" class="anchor"> </a>Acknowledgements</h1>
<p>Credit for the name, &ldquo;treezy&rdquo;, goes to <span class="citation">@MilesMcBain</span>, thanks Miles!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>License</h2>
<p><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE">LICENSE</a></p>
<h2>Developers</h2><ul class="list-unstyled"><li>Nicholas Tierney <br><small class="roles"> Author, maintainer </small> </li>
</ul><html><body><h2>Dev status</h2><ul class="list-unstyled"><li><a href="https://travis-ci.org/njtierney/treezy">
  <img src="https://travis-ci.org/njtierney/treezy.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/njtierney/treezy">
  <img src="https://ci.appveyor.com/api/projects/status/github/njtierney/treezy?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
</ul></body></html></div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
